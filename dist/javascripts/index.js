"use strict";var input=document.getElementById("input"),submit=document.getElementById("submit"),downloadContent=document.getElementById("download-content"),downloader=document.getElementById("downloader"),txtTitle=document.getElementById("txt-title"),messageContent=document.getElementById("message-content"),socket=void 0;function isUrlValid(){return/wenku.baidu.com\/view\/\w+.html/.test(input.value)}function socketConnect(){(socket=io.connect("http://localhost:3000")).on("connect",function(){addMessage("webSocket连接已建立"),submit.disabled="disabled"}),socket.on("disconnect",function(){addMessage("webSocket连接已断开"),submit.disabled=""}),socket.on("stateChange",function(e){addMessage(e)}),socket.on("success",function(e){addMessage(e,1)}),socket.on("failure",function(e){addMessage(e,2)}),socket.on("file",function(e){"error"!==e&&addDownload(e)}),socket.emit("url",input.value)}function addMessage(e,t){var n=document.createElement("li");n.innerText=e,messageContent.appendChild(n),t&&2==+t?n.style.color="#ff0000":t&&1==+t&&(n.style.color="#0000ff")}function addDownload(e){downloadContent.style.display="block",downloader.download=e.title,downloader.href="/file/"+e.index+".txt",txtTitle.innerText=e.title}submit.addEventListener("click",function(){messageContent.innerHTML="",downloadContent.style.display="none",isUrlValid()?socketConnect():addMessage("url无效",2)});